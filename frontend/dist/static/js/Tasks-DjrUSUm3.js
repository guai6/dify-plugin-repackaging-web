import{d as _e,k as pe,v as E,m as R,x as me,p as fe,c as y,b as s,w as l,y as ge,a as o,z as ke,f as n,t as i,A as ve,B as be,C as ye,F as Ce,r as he,g as Te,D as Ee,G as we,q as r,i as w,H as xe,h as k,I as ze,J as Se,K as De,L as $e,M as C,s as Me,N as Ie,E as Be,e as Le,O as Re,P as Ve,Q as Fe,u as Pe,R as V,S as F,T as Ae,U as Ne,o as d,_ as Ue}from"./index-BrQRFijk.js";/* empty css                        *//* empty css               *//* empty css                  *//* empty css                    *//* empty css                 *//* empty css                             */import{b as x,a as Oe,c as Ge,g as Je,d as We,e as je,h as qe}from"./index-CqoqUkBq.js";/* empty css                   *//* empty css                   */const He={class:"tasks-page"},Ke={class:"header-content"},Qe={class:"header-left"},Xe={class:"header-right"},Ye={class:"task-expand"},Ze={key:0,class:"task-params"},et={key:1,class:"task-error"},tt={class:"task-name"},at={class:"task-mode"},st={class:"progress-cell"},lt={class:"progress-text"},nt={key:0,class:"progress-step"},ot={class:"time-cell"},it={class:"relative-time"},rt={class:"pagination-wrapper"},dt=_e({__name:"Tasks",setup(ct){const P=Pe(),c=pe(),h=E(!1),u=E(""),_=E(1),v=E(20),A=[{label:"等待中",value:"pending"},{label:"下载中",value:"downloading"},{label:"解压中",value:"extracting"},{label:"打包中",value:"packaging"},{label:"已完成",value:"completed"},{label:"失败",value:"failed"},{label:"已取消",value:"cancelled"}],D=R(()=>c.totalTasks),N=R(()=>{let a=c.tasks;return u.value&&(a=a.filter(e=>e.status===u.value)),a}),b=async()=>{h.value=!0;try{await c.fetchTasks({skip:(_.value-1)*v.value,limit:v.value,status:u.value||void 0})}finally{h.value=!1}},$=()=>{_.value=1,b()},U=a=>{v.value=a,_.value=1,b()},O=a=>{_.value=a,b()},G=a=>{z(a.task_id)},z=a=>{P.push(`/tasks/${a}`)},J=a=>{if(a.task_name)return a.task_name;const e=a.parameters||{};return a.mode==="market"?`${e.author}/${e.name} v${e.version}`:a.mode==="github"?`${e.repo} ${e.release}`:a.mode==="local"?e.original_filename||e.file_name||"本地文件":"未知任务"},M=a=>({market:"Marketplace",github:"Github",local:"本地文件"})[a]||a,W=a=>({pending:"",downloading:"warning",extracting:"warning",packaging:"warning",completed:"success",failed:"danger",cancelled:"info"})[a]||"",j=a=>{if(a==="completed")return"success";if(a==="failed")return"exception"},q=a=>["pending","downloading","extracting","packaging"].includes(a),H=a=>a==="completed",K=async a=>{try{await V.confirm("确定要取消这个任务吗？","确认取消",{type:"warning"}),await c.cancelTask(a)}catch(e){e!=="cancel"&&console.error("取消任务失败:",e)}},Q=a=>{const e=Ne.downloadResult(a);je(e)},X=a=>{qe(a)},Y=a=>{c.connectWebSocket(a),F.success("已连接实时日志")},Z=async a=>{try{await V.confirm("确定要删除这个任务记录吗？","确认删除",{type:"warning"}),c.removeTask(a),F.success("任务已删除")}catch(e){e!=="cancel"&&console.error("删除任务失败:",e)}};return me(u,()=>{$()}),fe(()=>{b()}),(a,e)=>{const T=ke,I=ye,ee=be,p=Te,B=ve,L=ge,m=Se,te=ze,ae=De,f=xe,se=$e,le=Me,ne=Le("ArrowDown"),oe=Be,S=Ve,ie=Re,re=Ie,de=Ae,ce=Fe,ue=we;return d(),y("div",He,[s(L,{class:"header-card"},{default:l(()=>[o("div",Ke,[o("div",Qe,[e[5]||(e[5]=o("h3",null,"任务管理",-1)),s(T,{type:"info"},{default:l(()=>[n("总计 "+i(D.value)+" 个任务",1)]),_:1})]),o("div",Xe,[s(B,null,{default:l(()=>[s(ee,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),placeholder:"筛选状态",clearable:"",style:{width:"150px"},onChange:$},{default:l(()=>[s(I,{label:"全部",value:""}),(d(),y(Ce,null,he(A,t=>s(I,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),s(p,{icon:h.value?"Loading":"Refresh",loading:h.value,onClick:b},{default:l(()=>e[6]||(e[6]=[n(" 刷新 ")])),_:1,__:[6]},8,["icon","loading"]),s(p,{type:"primary",onClick:e[1]||(e[1]=t=>a.$router.push("/dashboard"))},{default:l(()=>e[7]||(e[7]=[n(" 创建任务 ")])),_:1,__:[7]})]),_:1})])])]),_:1}),s(L,{class:"table-card"},{default:l(()=>[Ee((d(),w(de,{data:N.value,stripe:"",onRowClick:G,style:{width:"100%"}},{default:l(()=>[s(f,{type:"expand"},{default:l(({row:t})=>[o("div",Ye,[s(te,{column:2,border:""},{default:l(()=>[s(m,{label:"任务ID"},{default:l(()=>[n(i(t.task_id),1)]),_:2},1024),s(m,{label:"处理模式"},{default:l(()=>[s(T,null,{default:l(()=>[n(i(M(t.mode)),1)]),_:2},1024)]),_:2},1024),s(m,{label:"创建时间"},{default:l(()=>[n(i(r(x)(t.created_at)),1)]),_:2},1024),s(m,{label:"开始时间"},{default:l(()=>[n(i(r(x)(t.started_at)),1)]),_:2},1024),s(m,{label:"完成时间"},{default:l(()=>[n(i(r(x)(t.completed_at)),1)]),_:2},1024),s(m,{label:"文件大小"},{default:l(()=>[n(i(t.file_size?r(Oe)(t.file_size):"--"),1)]),_:2},1024)]),_:2},1024),t.parameters?(d(),y("div",Ze,[e[8]||(e[8]=o("h4",null,"任务参数",-1)),o("pre",null,i(r(Ge)(t.parameters)),1)])):k("",!0),t.error_message?(d(),y("div",et,[e[9]||(e[9]=o("h4",null,"错误信息",-1)),s(ae,{title:t.error_message,type:"error",closable:!1},null,8,["title"])])):k("",!0)])]),_:1}),s(f,{label:"任务名称","min-width":"200"},{default:l(({row:t})=>[o("div",tt,[s(se,{type:"primary",onClick:C(g=>z(t.task_id),["stop"])},{default:l(()=>[n(i(J(t)),1)]),_:2},1032,["onClick"]),o("div",at,[s(T,{size:"small"},{default:l(()=>[n(i(M(t.mode)),1)]),_:2},1024)])])]),_:1}),s(f,{label:"状态",width:"120"},{default:l(({row:t})=>[s(T,{type:W(t.status)},{default:l(()=>[n(i(r(Je)(t.status)),1)]),_:2},1032,["type"])]),_:1}),s(f,{label:"进度",width:"200"},{default:l(({row:t})=>[o("div",st,[s(le,{percentage:Math.round(t.progress*100),status:j(t.status),"show-text":!1},null,8,["percentage","status"]),o("span",lt,i(Math.round(t.progress*100))+"% ",1)]),t.current_step?(d(),y("div",nt,i(t.current_step),1)):k("",!0)]),_:1}),s(f,{label:"创建时间",width:"180"},{default:l(({row:t})=>[o("div",ot,[o("div",null,i(r(x)(t.created_at)),1),o("div",it,i(r(We)(t.created_at)),1)])]),_:1}),s(f,{label:"操作",width:"200",fixed:"right"},{default:l(({row:t})=>[s(B,null,{default:l(()=>[s(p,{size:"small",onClick:C(g=>z(t.task_id),["stop"])},{default:l(()=>e[10]||(e[10]=[n(" 详情 ")])),_:2,__:[10]},1032,["onClick"]),q(t.status)?(d(),w(p,{key:0,size:"small",type:"warning",onClick:C(g=>K(t.task_id),["stop"])},{default:l(()=>e[11]||(e[11]=[n(" 取消 ")])),_:2,__:[11]},1032,["onClick"])):k("",!0),H(t.status)?(d(),w(p,{key:1,size:"small",type:"success",onClick:C(g=>Q(t.task_id),["stop"])},{default:l(()=>e[12]||(e[12]=[n(" 下载 ")])),_:2,__:[12]},1032,["onClick"])):k("",!0),s(re,{onClick:e[2]||(e[2]=C(()=>{},["stop"])),trigger:"click"},{dropdown:l(()=>[s(ie,null,{default:l(()=>[s(S,{onClick:g=>X(t.task_id)},{default:l(()=>e[14]||(e[14]=[n(" 复制任务ID ")])),_:2,__:[14]},1032,["onClick"]),t.task_id?(d(),w(S,{key:0,onClick:g=>Y(t.task_id)},{default:l(()=>e[15]||(e[15]=[n(" 连接实时日志 ")])),_:2,__:[15]},1032,["onClick"])):k("",!0),s(S,{divided:"",onClick:g=>Z(t.task_id)},{default:l(()=>e[16]||(e[16]=[n(" 删除任务 ")])),_:2,__:[16]},1032,["onClick"])]),_:2},1024)]),default:l(()=>[s(p,{size:"small"},{default:l(()=>[e[13]||(e[13]=n(" 更多 ")),s(oe,null,{default:l(()=>[s(ne)]),_:1})]),_:1,__:[13]})]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ue,r(c).loading]]),o("div",rt,[s(ce,{"current-page":_.value,"onUpdate:currentPage":e[3]||(e[3]=t=>_.value=t),"page-size":v.value,"onUpdate:pageSize":e[4]||(e[4]=t=>v.value=t),"page-sizes":[10,20,50,100],total:D.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:U,onCurrentChange:O},null,8,["current-page","page-size","total"])])]),_:1})])}}}),Ct=Ue(dt,[["__scopeId","data-v-ee343bc9"]]);export{Ct as default};
