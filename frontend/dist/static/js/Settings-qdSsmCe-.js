import{d as ee,l as se,v as y,a6 as le,m as L,p as ae,c as _,b as l,w as a,y as te,X as oe,a as t,g as re,f as r,$ as ne,a7 as ie,a8 as ue,a4 as de,h as b,I as _e,J as pe,t as o,q as g,s as ce,z as fe,F as N,r as T,S as me,o as p,_ as ve}from"./index-BrQRFijk.js";/* empty css               *//* empty css               *//* empty css                    *//* empty css                             *//* empty css                     */import{b as j,f as x,a as A,k as z}from"./index-CqoqUkBq.js";/* empty css                   */const ge={class:"settings-page"},he={class:"header-content"},ye={class:"card-header"},be={key:0,class:"system-info"},ke={class:"card-header"},we={key:0,class:"version-info"},Ce={key:0,class:"resource-status"},Ie={class:"resource-item"},Pe={class:"resource-header"},Ve={class:"resource-value"},Ee={class:"resource-item"},Se={class:"resource-header"},Re={class:"resource-value"},Ue={class:"resource-item"},Le={class:"resource-header"},xe={class:"resource-value"},Ae={class:"card-header"},ze={key:0,class:"health-status"},Fe={class:"health-overview"},De={class:"health-time"},Ge={key:0,class:"health-checks"},Me={class:"check-label"},qe={key:1,class:"health-issues"},Be={key:0,class:"storage-status"},He={class:"storage-item"},Ne={class:"storage-value"},Te={class:"storage-item"},je={class:"storage-value"},Je={class:"storage-item"},Oe={class:"storage-value"},Xe={class:"storage-usage"},$e=ee({__name:"Settings",setup(Ke){const f=se(),w=y(!1),P=y(!1),V=y(!1),E=y(!1),v=y(null),c=y(null),S=y(),m=le({github_api_url:"",marketplace_api_url:"",pip_mirror_url:""}),J={github_api_url:[{required:!0,message:"请输入Github API URL",trigger:"blur"},{validator:(i,e,d)=>{z(e)?d():d(new Error("请输入有效的URL"))},trigger:"blur"}],marketplace_api_url:[{required:!0,message:"请输入Marketplace API URL",trigger:"blur"},{validator:(i,e,d)=>{z(e)?d():d(new Error("请输入有效的URL"))},trigger:"blur"}],pip_mirror_url:[{required:!0,message:"请输入Pip镜像URL",trigger:"blur"},{validator:(i,e,d)=>{z(e)?d():d(new Error("请输入有效的URL"))},trigger:"blur"}]},n=L(()=>f.systemStatus),F=L(()=>f.apiConfig),k=L(()=>f.storageInfo),D=async()=>{w.value=!0;try{await Promise.all([f.fetchSystemStatus(),f.fetchApiConfig(),f.fetchStorageInfo()]),F.value&&Object.assign(m,F.value)}finally{w.value=!1}},O=async()=>{if(S.value)try{await S.value.validate(),P.value=!0,await f.updateApiConfig(m),me.success("配置保存成功")}catch(i){console.error("保存配置失败:",i)}finally{P.value=!1}},X=async()=>{V.value=!0;try{v.value=await f.getVersion()}finally{V.value=!1}},$=async()=>{E.value=!0;try{c.value=await f.healthCheck()}finally{E.value=!1}},C=i=>i<60?"#67c23a":i<80?"#e6a23c":"#f56c6c",K=i=>({healthy:"success",warning:"warning",error:"danger"})[i]||"info",Q=i=>({healthy:"健康",warning:"警告",error:"错误"})[i]||"未知",W=i=>({upload_dir:"上传目录",output_dir:"输出目录",memory_ok:"内存状态",disk_ok:"磁盘状态"})[i]||i,G=i=>i.total_space?i.used_space/i.total_space*100:0;return ae(()=>{D()}),(i,e)=>{const d=re,h=te,R=de,U=ue,Y=ie,u=pe,M=_e,q=ne,I=ce,B=fe,Z=oe;return p(),_("div",ge,[l(h,{class:"header-card"},{default:a(()=>[t("div",he,[e[4]||(e[4]=t("h3",null,"系统设置",-1)),l(d,{icon:w.value?"Loading":"Refresh",loading:w.value,onClick:D},{default:a(()=>e[3]||(e[3]=[r(" 刷新数据 ")])),_:1,__:[3]},8,["icon","loading"])])]),_:1}),l(Z,{gutter:24},{default:a(()=>[l(q,{span:16},{default:a(()=>[l(h,{class:"config-card"},{header:a(()=>[t("div",ye,[e[6]||(e[6]=t("span",null,"API配置",-1)),l(d,{type:"primary",size:"small",onClick:O,loading:P.value},{default:a(()=>e[5]||(e[5]=[r(" 保存配置 ")])),_:1,__:[5]},8,["loading"])])]),default:a(()=>[l(Y,{ref_key:"configFormRef",ref:S,model:m,rules:J,"label-width":"160px"},{default:a(()=>[l(U,{label:"Github API URL",prop:"github_api_url"},{default:a(()=>[l(R,{modelValue:m.github_api_url,"onUpdate:modelValue":e[0]||(e[0]=s=>m.github_api_url=s),placeholder:"https://github.com"},null,8,["modelValue"]),e[7]||(e[7]=t("div",{class:"form-help"}," 用于从Github下载插件的API地址 ",-1))]),_:1,__:[7]}),l(U,{label:"Marketplace API URL",prop:"marketplace_api_url"},{default:a(()=>[l(R,{modelValue:m.marketplace_api_url,"onUpdate:modelValue":e[1]||(e[1]=s=>m.marketplace_api_url=s),placeholder:"https://marketplace.dify.ai"},null,8,["modelValue"]),e[8]||(e[8]=t("div",{class:"form-help"}," 用于从Dify Marketplace下载插件的API地址 ",-1))]),_:1,__:[8]}),l(U,{label:"Pip镜像URL",prop:"pip_mirror_url"},{default:a(()=>[l(R,{modelValue:m.pip_mirror_url,"onUpdate:modelValue":e[2]||(e[2]=s=>m.pip_mirror_url=s),placeholder:"https://mirrors.aliyun.com/pypi/simple"},null,8,["modelValue"]),e[9]||(e[9]=t("div",{class:"form-help"}," 用于下载Python包的镜像地址 ",-1))]),_:1,__:[9]})]),_:1},8,["model"])]),_:1}),l(h,{class:"info-card"},{header:a(()=>e[10]||(e[10]=[t("span",null,"系统信息",-1)])),default:a(()=>[n.value?(p(),_("div",be,[l(M,{column:2,border:""},{default:a(()=>[l(u,{label:"应用名称"},{default:a(()=>{var s;return[r(o(((s=n.value.app_info)==null?void 0:s.name)||"--"),1)]}),_:1}),l(u,{label:"应用版本"},{default:a(()=>{var s;return[r(o(((s=n.value.app_info)==null?void 0:s.version)||"--"),1)]}),_:1}),l(u,{label:"操作系统"},{default:a(()=>{var s;return[r(o(((s=n.value.system_info)==null?void 0:s.platform)||"--"),1)]}),_:1}),l(u,{label:"系统版本"},{default:a(()=>{var s;return[r(o(((s=n.value.system_info)==null?void 0:s.platform_release)||"--"),1)]}),_:1}),l(u,{label:"系统架构"},{default:a(()=>{var s;return[r(o(((s=n.value.system_info)==null?void 0:s.architecture)||"--"),1)]}),_:1}),l(u,{label:"Python版本"},{default:a(()=>{var s;return[r(o(((s=n.value.system_info)==null?void 0:s.python_version)||"--"),1)]}),_:1}),l(u,{label:"上传目录"},{default:a(()=>{var s;return[r(o(((s=n.value.app_info)==null?void 0:s.upload_dir)||"--"),1)]}),_:1}),l(u,{label:"输出目录"},{default:a(()=>{var s;return[r(o(((s=n.value.app_info)==null?void 0:s.output_dir)||"--"),1)]}),_:1}),l(u,{label:"最大文件大小",span:2},{default:a(()=>{var s;return[r(o(((s=n.value.app_info)==null?void 0:s.max_file_size)||"--"),1)]}),_:1})]),_:1})])):b("",!0)]),_:1}),l(h,{class:"version-card"},{header:a(()=>[t("div",ke,[e[12]||(e[12]=t("span",null,"版本信息",-1)),l(d,{size:"small",onClick:X,loading:V.value},{default:a(()=>e[11]||(e[11]=[r(" 获取版本信息 ")])),_:1,__:[11]},8,["loading"])])]),default:a(()=>[v.value?(p(),_("div",we,[l(M,{column:2,border:""},{default:a(()=>[l(u,{label:"应用名称"},{default:a(()=>[r(o(v.value.app_name||"--"),1)]),_:1}),l(u,{label:"版本号"},{default:a(()=>[r(o(v.value.version||"--"),1)]),_:1}),l(u,{label:"构建时间"},{default:a(()=>[r(o(g(j)(v.value.build_time)),1)]),_:1}),l(u,{label:"Git分支"},{default:a(()=>{var s;return[r(o(((s=v.value.git)==null?void 0:s.branch)||"--"),1)]}),_:1}),l(u,{label:"Git提交"},{default:a(()=>{var s;return[r(o(((s=v.value.git)==null?void 0:s.commit)||"--"),1)]}),_:1}),l(u,{label:"Python版本"},{default:a(()=>[r(o(v.value.python_version||"--"),1)]),_:1})]),_:1})])):b("",!0)]),_:1})]),_:1}),l(q,{span:8},{default:a(()=>[l(h,{class:"status-card"},{header:a(()=>e[13]||(e[13]=[t("span",null,"系统资源",-1)])),default:a(()=>[n.value?(p(),_("div",Ce,[t("div",Ie,[t("div",Pe,[e[14]||(e[14]=t("span",{class:"resource-label"},"CPU使用率",-1)),t("span",Ve,o(g(x)(n.value.cpu_percent)),1)]),l(I,{percentage:n.value.cpu_percent,color:C(n.value.cpu_percent),"show-text":!1},null,8,["percentage","color"])]),t("div",Ee,[t("div",Se,[e[15]||(e[15]=t("span",{class:"resource-label"},"内存使用率",-1)),t("span",Re,o(g(x)(n.value.memory_percent)),1)]),l(I,{percentage:n.value.memory_percent,color:C(n.value.memory_percent),"show-text":!1},null,8,["percentage","color"])]),t("div",Ue,[t("div",Le,[e[16]||(e[16]=t("span",{class:"resource-label"},"磁盘使用率",-1)),t("span",xe,o(g(x)(n.value.disk_percent)),1)]),l(I,{percentage:n.value.disk_percent,color:C(n.value.disk_percent),"show-text":!1},null,8,["percentage","color"])])])):b("",!0)]),_:1}),l(h,{class:"health-card"},{header:a(()=>[t("div",Ae,[e[18]||(e[18]=t("span",null,"健康检查",-1)),l(d,{size:"small",onClick:$,loading:E.value},{default:a(()=>e[17]||(e[17]=[r(" 检查健康状态 ")])),_:1,__:[17]},8,["loading"])])]),default:a(()=>[c.value?(p(),_("div",ze,[t("div",Fe,[l(B,{type:K(c.value.status),size:"large",class:"health-tag"},{default:a(()=>[r(o(Q(c.value.status)),1)]),_:1},8,["type"]),t("span",De,o(g(j)(c.value.timestamp)),1)]),c.value.checks?(p(),_("div",Ge,[e[19]||(e[19]=t("h4",null,"检查项目",-1)),(p(!0),_(N,null,T(c.value.checks,(s,H)=>(p(),_("div",{key:H,class:"check-item"},[t("span",Me,o(W(H)),1),l(B,{type:s?"success":"danger",size:"small"},{default:a(()=>[r(o(s?"正常":"异常"),1)]),_:2},1032,["type"])]))),128))])):b("",!0),c.value.issues&&c.value.issues.length>0?(p(),_("div",qe,[e[20]||(e[20]=t("h4",null,"问题列表",-1)),t("ul",null,[(p(!0),_(N,null,T(c.value.issues,s=>(p(),_("li",{key:s,class:"issue-item"},o(s),1))),128))])])):b("",!0)])):b("",!0)]),_:1}),l(h,{class:"storage-card"},{header:a(()=>e[21]||(e[21]=[t("span",null,"存储状态",-1)])),default:a(()=>[k.value?(p(),_("div",Be,[t("div",He,[e[22]||(e[22]=t("span",{class:"storage-label"},"已用空间",-1)),t("span",Ne,o(g(A)(k.value.used_space)),1)]),t("div",Te,[e[23]||(e[23]=t("span",{class:"storage-label"},"总空间",-1)),t("span",je,o(g(A)(k.value.total_space)),1)]),t("div",Je,[e[24]||(e[24]=t("span",{class:"storage-label"},"剩余空间",-1)),t("span",Oe,o(g(A)(k.value.free_space)),1)]),t("div",Xe,[e[25]||(e[25]=t("span",{class:"usage-label"},"使用率",-1)),l(I,{percentage:G(k.value),color:C(G(k.value))},null,8,["percentage","color"])])])):b("",!0)]),_:1})]),_:1})]),_:1})])}}}),ts=ve($e,[["__scopeId","data-v-91cb2384"]]);export{ts as default};
