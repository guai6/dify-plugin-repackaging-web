import{a1 as De,v as f,a2 as R,S as b,d as ze,l as $e,m as G,p as Ie,c as C,b as t,w as l,y as Be,X as Le,a3 as Ue,a as o,z as Pe,f as n,t as c,A as Re,a4 as je,E as Ae,e as j,B as Me,C as Ne,g as Oe,$ as He,q as w,D as ae,G as Ge,i as S,H as qe,h as A,j as Je,L as Ke,I as Xe,J as Qe,a5 as We,K as Ye,R as q,u as Ze,T as et,o as u,_ as tt}from"./index-BrQRFijk.js";/* empty css                        *//* empty css                   *//* empty css                 *//* empty css                             *//* empty css                  *//* empty css               *//* empty css               */import{a as M,b as se,d as lt,i as at,h as st}from"./index-CqoqUkBq.js";/* empty css                   */const ot=De("file",()=>{const D=f([]),z=f(!1),y=async(d="all")=>{try{z.value=!0;const r=await R.getFiles(d);D.value=r}catch(r){console.error("获取文件列表失败:",r),b.error("获取文件列表失败")}finally{z.value=!1}};return{files:D,loading:z,fetchFiles:y,deleteFile:async(d,r)=>{try{await R.deleteFile(d,r);const _=D.value.findIndex(i=>i.name===r&&i.type===d);_!==-1&&D.value.splice(_,1),b.success("文件删除成功")}catch(_){console.error("删除文件失败:",_)}},cleanupTempFiles:async()=>{try{const d=await R.cleanupTempFiles();b.success(d.message),await y()}catch(d){console.error("清理临时文件失败:",d)}},downloadFile:(d,r)=>{const _=R.downloadFile(d,r),i=document.createElement("a");i.href=_,i.download=r,i.target="_blank",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}}),nt={class:"files-page"},it={class:"header-content"},ct={class:"header-left"},dt={class:"header-right"},rt={class:"stat-content"},ut={class:"stat-value"},_t={class:"stat-icon"},pt={class:"stat-content"},vt={class:"stat-value"},mt={class:"stat-icon"},ft={class:"stat-content"},yt={class:"stat-value"},gt={class:"stat-icon"},ht={class:"stat-content"},wt={class:"stat-value"},bt={class:"stat-icon"},kt={class:"table-header"},Ct={class:"table-actions"},Ft={class:"file-name"},Et={class:"name"},xt={class:"time-cell"},Tt={class:"relative-time"},Vt={key:1,class:"no-task"},St={key:0,class:"file-preview"},Dt={class:"file-path"},zt={key:0,class:"file-content-preview"},$t={class:"content-container"},It={key:1,class:"no-content"},Bt={key:1,class:"unsupported-preview"},Lt=ze({__name:"Files",setup(D){const z=Ze(),y=ot(),N=$e(),$=f(!1),F=f("all"),d=f(""),r=f("created_at"),_=f("desc"),i=f([]),I=f(!1),p=f(null),h=f(""),B=f(!1),J=G(()=>y.files),U=G(()=>N.storageInfo),oe=G(()=>{let a=J.value;if(F.value!=="all"&&(a=a.filter(e=>e.type===F.value)),d.value.trim()){const e=d.value.toLowerCase().trim();a=a.filter(v=>v.name.toLowerCase().includes(e))}return a=a.sort((e,v)=>{let k,m;switch(r.value){case"name":k=e.name.toLowerCase(),m=v.name.toLowerCase();break;case"size":k=e.size,m=v.size;break;case"created_at":default:k=new Date(e.created_at).getTime(),m=new Date(v.created_at).getTime();break}return _.value==="asc"?k>m?1:-1:k<m?1:-1}),a}),E=async()=>{$.value=!0;try{await Promise.all([y.fetchFiles(F.value),N.fetchStorageInfo()])}finally{$.value=!1}},ne=()=>{E()},ie=()=>{},ce=()=>{},de=()=>{_.value=_.value==="asc"?"desc":"asc"},re=a=>{i.value=a},K=a=>{y.downloadFile(a.type,a.name)},ue=async a=>{p.value=a,I.value=!0,h.value="",X(a.name)&&await pe(a)},_e=()=>{I.value=!1,p.value=null,h.value="",B.value=!1},X=a=>{const e=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".py",".java",".cpp",".c",".h",".log",".yml",".yaml",".ini",".conf",".config",".sh",".bat",".dockerfile",".gitignore"],v=a.toLowerCase().substring(a.lastIndexOf("."));return e.includes(v)},pe=async a=>{try{if(B.value=!0,a.size>1024*1024){h.value="文件过大（超过1MB），不支持在线预览，请下载后查看。";return}const e=await fetch(fileApi.getFileContentUrl(a.type,a.name),{method:"GET"});if(e.ok){const v=await e.text();h.value=v}else h.value="无法加载文件内容"}catch(e){console.error("加载文件内容失败:",e),h.value="加载文件内容失败"}finally{B.value=!1}},ve=async a=>{try{await q.confirm(`确定要删除文件 "${a.name}" 吗？`,"确认删除",{type:"warning"}),await y.deleteFile(a.type,a.name),await E()}catch(e){e!=="cancel"&&console.error("删除文件失败:",e)}},me=async()=>{try{if(i.value.length===0){b.warning("请选择要下载的文件");return}b.info(`开始下载 ${i.value.length} 个文件...`);for(const a of i.value)await new Promise(e=>{y.downloadFile(a.type,a.name),setTimeout(e,500)});b.success("批量下载完成"),i.value=[]}catch(a){console.error("批量下载失败:",a),b.error("批量下载失败")}},fe=async()=>{try{await q.confirm(`确定要删除选中的 ${i.value.length} 个文件吗？`,"确认批量删除",{type:"warning"});const a=i.value.map(e=>y.deleteFile(e.type,e.name));await Promise.all(a),i.value=[],await E(),b.success("批量删除成功")}catch(a){a!=="cancel"&&console.error("批量删除失败:",a)}},ye=async()=>{try{await q.confirm("确定要清理临时文件吗？这将删除超过24小时的临时文件。","确认清理",{type:"warning"}),await y.cleanupTempFiles(),await E()}catch(a){a!=="cancel"&&console.error("清理失败:",a)}},ge=a=>{z.push(`/tasks/${a}`)},he=a=>at(a),we=a=>({input:"",output:"success",temp:"warning"})[a]||"",Q=a=>({input:"输入文件",output:"输出文件",temp:"临时文件"})[a]||a,be=a=>{st(a)};return Ie(()=>{E()}),(a,e)=>{var le;const v=Pe,k=j("Search"),m=Ae,W=je,x=Ne,Y=Me,g=Oe,O=Re,T=Be,Z=j("HardDisk"),P=He,ke=j("Upload"),Ce=j("Download"),Fe=Le,V=qe,Ee=Ke,xe=et,L=Qe,Te=Xe,ee=We,Ve=Ye,Se=Ue,te=Ge;return u(),C("div",nt,[t(T,{class:"header-card"},{default:l(()=>[o("div",it,[o("div",ct,[e[8]||(e[8]=o("h3",null,"文件管理",-1)),t(v,{type:"info"},{default:l(()=>[n(c(J.value.length)+" 个文件 ",1)]),_:1})]),o("div",dt,[t(O,null,{default:l(()=>[t(W,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s),placeholder:"搜索文件名",style:{width:"200px"},clearable:"",onInput:ie},{prefix:l(()=>[t(m,null,{default:l(()=>[t(k)]),_:1})]),_:1},8,["modelValue"]),t(Y,{modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=s=>F.value=s),placeholder:"文件类型",style:{width:"150px"},onChange:ne},{default:l(()=>[t(x,{label:"全部文件",value:"all"}),t(x,{label:"输入文件",value:"input"}),t(x,{label:"输出文件",value:"output"})]),_:1},8,["modelValue"]),t(Y,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=s=>r.value=s),placeholder:"排序方式",style:{width:"150px"},onChange:ce},{default:l(()=>[t(x,{label:"创建时间",value:"created_at"}),t(x,{label:"文件名",value:"name"}),t(x,{label:"文件大小",value:"size"})]),_:1},8,["modelValue"]),t(g,{icon:_.value==="asc"?"Sort":"SortDown",onClick:de},{default:l(()=>[n(c(_.value==="asc"?"升序":"降序"),1)]),_:1},8,["icon"]),t(g,{icon:$.value?"Loading":"Refresh",loading:$.value,onClick:E},{default:l(()=>e[9]||(e[9]=[n(" 刷新 ")])),_:1,__:[9]},8,["icon","loading"]),t(g,{type:"warning",onClick:ye},{default:l(()=>e[10]||(e[10]=[n(" 清理临时文件 ")])),_:1,__:[10]})]),_:1})])])]),_:1}),t(Fe,{gutter:24,class:"storage-section"},{default:l(()=>[t(P,{span:6},{default:l(()=>[t(T,{class:"stat-card"},{default:l(()=>{var s;return[o("div",rt,[o("div",ut,c(w(M)(((s=U.value)==null?void 0:s.used_space)||0)),1),e[11]||(e[11]=o("div",{class:"stat-label"},"已用空间",-1))]),o("div",_t,[t(m,null,{default:l(()=>[t(Z)]),_:1})])]}),_:1})]),_:1}),t(P,{span:6},{default:l(()=>[t(T,{class:"stat-card"},{default:l(()=>{var s;return[o("div",pt,[o("div",vt,c(w(M)(((s=U.value)==null?void 0:s.total_space)||0)),1),e[12]||(e[12]=o("div",{class:"stat-label"},"总空间",-1))]),o("div",mt,[t(m,null,{default:l(()=>[t(Z)]),_:1})])]}),_:1})]),_:1}),t(P,{span:6},{default:l(()=>[t(T,{class:"stat-card"},{default:l(()=>{var s;return[o("div",ft,[o("div",yt,c(((s=U.value)==null?void 0:s.upload_count)||0),1),e[13]||(e[13]=o("div",{class:"stat-label"},"上传文件",-1))]),o("div",gt,[t(m,null,{default:l(()=>[t(ke)]),_:1})])]}),_:1})]),_:1}),t(P,{span:6},{default:l(()=>[t(T,{class:"stat-card"},{default:l(()=>{var s;return[o("div",ht,[o("div",wt,c(((s=U.value)==null?void 0:s.output_count)||0),1),e[14]||(e[14]=o("div",{class:"stat-label"},"输出文件",-1))]),o("div",bt,[t(m,null,{default:l(()=>[t(Ce)]),_:1})])]}),_:1})]),_:1})]),_:1}),t(T,{class:"table-card"},{header:l(()=>[o("div",kt,[e[15]||(e[15]=o("span",null,"文件列表",-1)),o("div",Ct,[i.value.length>0?(u(),S(O,{key:0},{default:l(()=>[t(g,{type:"primary",size:"small",onClick:me},{default:l(()=>[n(" 批量下载 ("+c(i.value.length)+") ",1)]),_:1}),t(g,{type:"danger",size:"small",onClick:fe},{default:l(()=>[n(" 批量删除 ("+c(i.value.length)+") ",1)]),_:1})]),_:1})):A("",!0)])])]),default:l(()=>[ae((u(),S(xe,{data:oe.value,stripe:"",onSelectionChange:re,style:{width:"100%"}},{default:l(()=>[t(V,{type:"selection",width:"55"}),t(V,{label:"文件名","min-width":"300"},{default:l(({row:s})=>[o("div",Ft,[t(m,{class:"file-icon"},{default:l(()=>[(u(),S(Je(he(s.name))))]),_:2},1024),o("span",Et,c(s.name),1),s.type?(u(),S(v,{key:0,type:we(s.type),size:"small",class:"file-type-tag"},{default:l(()=>[n(c(Q(s.type)),1)]),_:2},1032,["type"])):A("",!0)])]),_:1}),t(V,{label:"文件大小",width:"120"},{default:l(({row:s})=>[n(c(w(M)(s.size)),1)]),_:1}),t(V,{label:"创建时间",width:"180"},{default:l(({row:s})=>[o("div",xt,[o("div",null,c(w(se)(s.created_at)),1),o("div",Tt,c(w(lt)(s.created_at)),1)])]),_:1}),t(V,{label:"关联任务",width:"150"},{default:l(({row:s})=>[s.task_id?(u(),S(Ee,{key:0,type:"primary",onClick:H=>ge(s.task_id)},{default:l(()=>e[16]||(e[16]=[n(" 查看任务 ")])),_:2,__:[16]},1032,["onClick"])):(u(),C("span",Vt,"--"))]),_:1}),t(V,{label:"操作",width:"200",fixed:"right"},{default:l(({row:s})=>[t(O,null,{default:l(()=>[t(g,{size:"small",type:"primary",onClick:H=>K(s)},{default:l(()=>e[17]||(e[17]=[n(" 下载 ")])),_:2,__:[17]},1032,["onClick"]),t(g,{size:"small",onClick:H=>ue(s)},{default:l(()=>e[18]||(e[18]=[n(" 预览 ")])),_:2,__:[18]},1032,["onClick"]),t(g,{size:"small",type:"danger",onClick:H=>ve(s)},{default:l(()=>e[19]||(e[19]=[n(" 删除 ")])),_:2,__:[19]},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[te,w(y).loading]])]),_:1}),t(Se,{modelValue:I.value,"onUpdate:modelValue":e[7]||(e[7]=s=>I.value=s),title:`文件预览 - ${(le=p.value)==null?void 0:le.name}`,width:"80%","before-close":_e},{footer:l(()=>[t(g,{onClick:e[5]||(e[5]=s=>I.value=!1)},{default:l(()=>e[23]||(e[23]=[n("关闭")])),_:1,__:[23]}),t(g,{type:"primary",onClick:e[6]||(e[6]=s=>K(p.value))},{default:l(()=>e[24]||(e[24]=[n(" 下载文件 ")])),_:1,__:[24]})]),default:l(()=>[p.value?(u(),C("div",St,[t(Te,{column:2,border:""},{default:l(()=>[t(L,{label:"文件名"},{default:l(()=>[n(c(p.value.name),1)]),_:1}),t(L,{label:"文件大小"},{default:l(()=>[n(c(w(M)(p.value.size)),1)]),_:1}),t(L,{label:"文件类型"},{default:l(()=>[n(c(Q(p.value.type)),1)]),_:1}),t(L,{label:"创建时间"},{default:l(()=>[n(c(w(se)(p.value.created_at)),1)]),_:1}),t(L,{label:"文件路径",span:2},{default:l(()=>[o("div",Dt,[n(c(p.value.path)+" ",1),t(g,{size:"small",onClick:e[3]||(e[3]=s=>be(p.value.path))},{default:l(()=>e[20]||(e[20]=[n(" 复制路径 ")])),_:1,__:[20]})])]),_:1})]),_:1}),X(p.value.name)?(u(),C("div",zt,[t(ee,null,{default:l(()=>e[21]||(e[21]=[n("文件内容")])),_:1,__:[21]}),ae((u(),C("div",$t,[h.value?(u(),S(W,{key:0,modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=s=>h.value=s),type:"textarea",rows:15,readonly:"",class:"content-textarea"},null,8,["modelValue"])):B.value?A("",!0):(u(),C("div",It," 无法预览该文件类型或文件为空 "))])),[[te,B.value]])])):(u(),C("div",Bt,[t(ee,null,{default:l(()=>e[22]||(e[22]=[n("文件内容")])),_:1,__:[22]}),t(Ve,{title:"不支持预览",type:"info",description:"该文件类型不支持在线预览，请下载后查看。","show-icon":"",closable:!1})]))])):A("",!0)]),_:1},8,["modelValue","title"])])}}}),qt=tt(Lt,[["__scopeId","data-v-d2c11a74"]]);export{qt as default};
